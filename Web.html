<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Spinner Surah Profesional</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

<style>
body {
  background: #eef7f1;
}

#wrapper {
  width: 360px;
  margin: auto;
  position: relative;
}

canvas {
  display: block;
  margin: auto;
}

.jarum {
  position: absolute;
  top: 50%;
  left: 50%;
  width: 6px;
  height: 150px;
  background: black;
  transform: translate(-50%, -100%);
  clip-path: polygon(50% 0%, 100% 100%, 0% 100%);
  z-index: 10;
}

.logo-tengah {
  position: absolute;
  top: 50%;
  left: 50%;
  width: 90px;
  height: 90px;
  transform: translate(-50%, -50%);
  background: white;
  border-radius: 50%;
  padding: 8px;
  z-index: 5;
}
</style>
</head>

<body>
<div class="container text-center mt-4">
  <h4 class="fw-bold">Spinner Penentuan Surah</h4>

  <div id="wrapper" class="mt-3">
    <div class="jarum"></div>
    <img src="logo.png" class="logo-tengah">
    <canvas id="wheel"></canvas>
  </div>

  <button class="btn btn-success mt-4 px-4" onclick="spin()">PUTAR</button>

  <div id="hasil" class="alert alert-info mt-3">
    Tekan PUTAR
  </div>
</div>

<!-- AUDIO -->
<audio id="spinSound" src="spin.mp3" preload="auto"></audio>
<audio id="clickSound" src="click.mp3" preload="auto"></audio>
<audio id="stopSound" src="stop.mp3" preload="auto"></audio>

<script>
/* ================== CANVAS HD (ANTI BLUR) ================== */
const canvas = document.getElementById("wheel");
const ctx = canvas.getContext("2d");

const dpr = window.devicePixelRatio || 1;
const size = 350;
canvas.width = size * dpr;
canvas.height = size * dpr;
canvas.style.width = size + "px";
canvas.style.height = size + "px";
ctx.scale(dpr, dpr);

const r = size / 2;

/* ================== AUDIO ================== */
const spinSound = document.getElementById("spinSound");
const clickSound = document.getElementById("clickSound");
const stopSound = document.getElementById("stopSound");

/* ================== DATA 50 SLOT ================== */
const surah = [
  // Juz 29
  {nama:"Al-Mulk",max:30},{nama:"Al-Qalam",max:52},{nama:"Al-Haqqah",max:52},
  {nama:"Al-Ma'arij",max:44},{nama:"Nuh",max:28},{nama:"Al-Jinn",max:28},
  {nama:"Al-Muzzammil",max:20},{nama:"Al-Muddatsir",max:56},
  {nama:"Al-Qiyamah",max:40},{nama:"Al-Insan",max:31},
  {nama:"Al-Mursalat",max:50},

  // Juz 30 (sampai Al-Lail)
  {nama:"An-Naba",max:40},{nama:"An-Naziat",max:46},{nama:"Abasa",max:42},
  {nama:"At-Takwir",max:29},{nama:"Al-Infitar",max:19},
  {nama:"Al-Muthaffifin",max:36},{nama:"Al-Insyiqaq",max:25},
  {nama:"Al-Buruj",max:22},{nama:"At-Tariq",max:17},
  {nama:"Al-A'la",max:19},{nama:"Al-Ghasyiyah",max:26},
  {nama:"Al-Fajr",max:30},{nama:"Al-Balad",max:20},
  {nama:"Asy-Syams",max:15},{nama:"Al-Lail",max:21},

  // Duplikasi agar genap 50 slot
  {nama:"Al-Mulk",max:30},{nama:"Al-Qalam",max:52},{nama:"An-Naba",max:40},
  {nama:"An-Naziat",max:46},{nama:"Abasa",max:42},{nama:"At-Takwir",max:29},
  {nama:"Al-Infitar",max:19},{nama:"Al-Buruj",max:22},
  {nama:"Al-Fajr",max:30},{nama:"Al-Lail",max:21},
  {nama:"Al-Mursalat",max:50},{nama:"Al-Qiyamah",max:40},
  {nama:"Al-Insan",max:31},{nama:"Al-Muddatsir",max:56},
  {nama:"Al-Jinn",max:28}
];

let used = [];
let spinning = false;

/* ================== DRAW ================== */
function draw(rotation = 0) {
  ctx.setTransform(dpr,0,0,dpr,0,0);
  ctx.clearRect(0,0,size,size);
  ctx.translate(r, r);
  ctx.rotate(rotation);

  const slice = 2 * Math.PI / surah.length;

  surah.forEach((s,i)=>{
    ctx.beginPath();
    ctx.moveTo(0,0);
    ctx.arc(0,0,r,i*slice,(i+1)*slice);
    ctx.closePath();

    ctx.fillStyle = used.includes(i) ? "#c0392b" : "#1e8449";
    ctx.fill();

    ctx.strokeStyle = "#ffffff";
    ctx.lineWidth = 2;
    ctx.stroke();

    // TEKS TAJAM
    ctx.save();
    ctx.rotate(i*slice + slice/2);
    ctx.textAlign = "right";
    ctx.textBaseline = "middle";
    ctx.fillStyle = "#ffffff";
    ctx.font = "bold 13px Arial";
    ctx.fillText(s.nama, r - 12, 0);
    ctx.restore();
  });
}

draw();

/* ================== SPIN ================== */
function spin(){
  if(spinning) return;

  clickSound.currentTime = 0;
  clickSound.play();

  if(used.length === surah.length){
    alert("Semua surah sudah terpilih");
    return;
  }

  spinning = true;
  spinSound.currentTime = 0;
  spinSound.play();

  let target;
  do {
    target = Math.floor(Math.random()*surah.length);
  } while (used.includes(target));

  const slice = 2 * Math.PI / surah.length;
  const targetAngle = (Math.PI * 3/2) - (target * slice + slice/2);
  const totalSpin = targetAngle + Math.PI * 2 * 6;

  let start = null;
  const duration = 5000;

  function animate(time){
    if(!start) start = time;
    const t = Math.min((time-start)/duration,1);
    const ease = 1 - Math.pow(1-t,3);

    draw(ease * totalSpin);

    if(t < 1){
      requestAnimationFrame(animate);
    } else {
      spinSound.pause();
      stopSound.currentTime = 0;
      stopSound.play();

      used.push(target);
      const ayat = Math.floor(Math.random()*surah[target].max) + 1;

      document.getElementById("hasil").innerHTML =
        `ðŸ“– <b>Surah ${surah[target].nama}</b><br>Ayat <b>${ayat}</b>`;

      draw(totalSpin);
      spinning = false;
    }
  }
  requestAnimationFrame(animate);
}
</script>
</body>
</html>