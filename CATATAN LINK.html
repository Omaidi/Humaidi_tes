<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>S-DRAFTER ELITE V6 FINAL</title>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;700;800&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <style>
        /* CSS VARIABEL - KONTROL WARNA UTAMA */
        :root {
            --bg: #f4f7f9;
            --card: #ffffff;
            --primary: #ff4d2d;
            --text-input: #000000; /* SIANG: TEKS HITAM */
            --bg-input: #ffffff;
            --border: #d1d5db;
            --text-muted: #64748b;
        }

        [data-theme="dark"] {
            --bg: #0f172a;
            --card: #1e293b;
            --text-input: #ffffff; /* MALAM: TEKS PUTIH */
            --bg-input: #000000; /* INPUT HITAM PEKAT */
            --border: #334155;
            --text-muted: #94a3b8;
        }

        * { box-sizing: border-box; transition: background 0.2s; }
        body { font-family: 'Plus Jakarta Sans', sans-serif; background: var(--bg); color: var(--text-input); margin: 0; display: flex; justify-content: center; }
        .app-wrapper { width: 100%; max-width: 500px; padding: 15px; min-height: 100vh; }

        /* HEADER */
        .top-bar { display: flex; justify-content: space-between; align-items: center; padding: 10px 5px 20px 5px; }
        .logo { font-weight: 800; font-size: 1.3rem; color: var(--primary); }
        .theme-toggle { background: var(--card); border: 1px solid var(--border); padding: 8px 15px; border-radius: 12px; color: var(--text-input); font-weight: 800; cursor: pointer; font-size: 0.75rem; }

        /* INPUT PANEL */
        #inputPanel { background: var(--card); padding: 20px; border-radius: 20px; border: 1px solid var(--border); margin-bottom: 25px; box-shadow: 0 10px 30px rgba(0,0,0,0.05); }
        #inputPanel.hidden { display: none; }
        .label { font-size: 0.7rem; font-weight: 800; color: var(--text-muted); margin-bottom: 8px; display: block; text-transform: uppercase; }

        /* FIX INPUT TEKS: HITAM DI SIANG, PUTIH DI MALAM */
        .input-box { 
            width: 100%; 
            background-color: var(--bg-input) !important; 
            color: var(--text-input) !important; 
            border: 2px solid var(--border); 
            padding: 12px 15px; 
            border-radius: 12px; 
            font-size: 1rem; 
            margin-bottom: 15px; 
            outline: none;
            display: block;
        }
        .input-box:focus { border-color: var(--primary); }

        /* KOLOM KOMISI: LEBAR & WARNA KONTRAS */
        .link-row { display: flex; gap: 10px; margin-bottom: 10px; }
        .inp-url { flex: 1.5; }
        .inp-comm { 
            flex: 0.8; 
            text-align: center; 
            font-weight: 800; 
            border-color: var(--primary); 
            color: var(--primary) !important; /* Angka tetap oranye agar cantik */
        }

        .btn-add { width: 100%; padding: 10px; background: none; border: 2px dashed var(--border); color: var(--text-muted); border-radius: 12px; font-weight: 700; margin-bottom: 15px; cursor: pointer; }
        .btn-save { width: 100%; padding: 16px; background: var(--primary); color: white; border: none; border-radius: 15px; font-weight: 800; font-size: 1rem; cursor: pointer; }

        /* SEARCH BAR */
        .search-bar { width: 100%; padding: 15px 20px; border-radius: 15px; border: 2px solid var(--border); background: var(--card); color: var(--text-input); font-size: 1rem; margin-bottom: 20px; outline: none; }

        /* DAFTAR CARD */
        .card { background: var(--card); border-radius: 22px; padding: 15px; margin-bottom: 15px; border: 1px solid var(--border); display: flex; gap: 15px; }
        .card-img { width: 95px; height: 95px; border-radius: 15px; object-fit: cover; background: #222; cursor: pointer; }
        .card-body { flex: 1; min-width: 0; }
        .card-title { font-size: 1.1rem; font-weight: 800; margin-bottom: 10px; color: var(--text-input); }
        
        /* TOMBOL SALIN SEMUA LINK */
        .btn-copy-all { 
            width: 100%; background: rgba(255, 77, 45, 0.1); 
            color: var(--primary); border: none; 
            padding: 10px; border-radius: 10px; font-weight: 800; 
            font-size: 0.75rem; margin-bottom: 12px; cursor: pointer;
            text-transform: uppercase;
        }

        /* LINK ITEM (BISA DIKLIK) */
        .link-item { 
            display: flex; justify-content: space-between; align-items: center;
            background: var(--bg); padding: 8px 12px; border-radius: 8px; 
            text-decoration: none; color: var(--text-input); font-size: 0.8rem;
            margin-bottom: 6px; border: 1px solid var(--border);
        }
        .link-item span { overflow: hidden; text-overflow: ellipsis; white-space: nowrap; max-width: 80%; color: var(--primary); font-weight: 600; }
        .comm-tag { color: #f59e0b; font-weight: 800; }

        .card-footer { display: flex; gap: 20px; margin-top: 10px; padding-top: 10px; border-top: 1px solid var(--border); }
        .btn-act { font-size: 0.75rem; font-weight: 800; cursor: pointer; border: none; background: none; color: var(--text-muted); text-transform: uppercase; }
        
        #zoomBox { position: fixed; top:0; left:0; width:100%; height:100%; background: rgba(0,0,0,0.9); display: none; justify-content: center; align-items: center; z-index: 2000; }
        #zoomBox img { max-width: 90%; border-radius: 10px; }
    </style>
</head>
<body data-theme="dark">

<div id="zoomBox" onclick="this.style.display='none'"><img src="" id="fullImg"></div>

<div class="app-wrapper">
    <div class="top-bar">
        <div class="logo">S-DRAFTER ELITE</div>
        <button class="theme-toggle" onclick="toggleTheme()" id="tBtn">‚òÄÔ∏è SIANG</button>
    </div>

    <input type="text" id="search" class="search-bar" placeholder="Cari Koleksi Draft..." onkeyup="doSearch()">

    <div id="inputPanel">
        <input type="hidden" id="editId">
        
        <label class="label">Nama Produk</label>
        <input type="text" id="pTitle" class="input-box" placeholder="Ketik nama produk...">
        
        <label class="label">Foto Produk</label>
        <input type="file" id="pImg" class="input-box" accept="image/*" style="padding: 10px 5px;">
        
        <label class="label">Link & Komisi (%)</label>
        <div id="linksArea">
            <div class="link-row">
                <input type="text" class="input-box inp-url" placeholder="Paste link Shopee">
                <input type="tel" class="input-box inp-comm" placeholder="10">
            </div>
        </div>
        <button class="btn-add" onclick="addRow()">+ Tambah Baris Link</button>
        <button class="btn-save" onclick="save()">SIMPAN DATA DRAFT</button>
    </div>

    <div id="list"></div>
</div>

<script>
    let db = JSON.parse(localStorage.getItem('shopee_v6_final')) || [];
    let imgBase64 = "";

    function toggleTheme() {
        const b = document.body;
        const isDark = b.getAttribute('data-theme') === 'dark';
        b.setAttribute('data-theme', isDark ? 'light' : 'dark');
        document.getElementById('tBtn').innerText = isDark ? 'üåô MALAM' : '‚òÄÔ∏è SIANG';
    }

    document.getElementById('pImg').addEventListener('change', function(e) {
        if(this.files[0]) {
            const reader = new FileReader();
            reader.onload = (ev) => { imgBase64 = ev.target.result; };
            reader.readAsDataURL(this.files[0]);
        }
    });

    function addRow(u="", c="") {
        const div = document.createElement('div');
        div.className = 'link-row';
        div.innerHTML = `
            <input type="text" class="input-box inp-url" placeholder="Paste link Shopee" value="${u}">
            <input type="tel" class="input-box inp-comm" placeholder="10" value="${c}">
        `;
        document.getElementById('linksArea').appendChild(div);
    }

    function save() {
        const id = document.getElementById('editId').value;
        const title = document.getElementById('pTitle').value;
        const rows = document.querySelectorAll('.link-row');
        let links = [];

        rows.forEach(r => {
            const u = r.querySelector('.inp-url').value;
            const c = r.querySelector('.inp-comm').value;
            if(u) links.push({ u, c });
        });

        if(!title || links.length === 0) return Swal.fire('Error', 'Judul & Link harus diisi!', 'error');

        const data = { id: id ? parseInt(id) : Date.now(), title: title.toUpperCase(), img: imgBase64, links };
        if(id) {
            const idx = db.findIndex(x => x.id == id);
            db[idx] = data;
        } else {
            db.unshift(data);
        }

        localStorage.setItem('shopee_v6_final', JSON.stringify(db));
        Swal.fire({ icon: 'success', title: 'Tersimpan!', showConfirmButton: false, timer: 1000 }).then(() => location.reload());
    }

    function copyAll(links, btn) {
        const text = links.map(l => l.u).join('\n');
        navigator.clipboard.writeText(text);
        const ori = btn.innerText;
        btn.innerText = "‚úÖ BERHASIL DISALIN!";
        setTimeout(() => btn.innerText = ori, 1500);
    }

    function doSearch() {
        const q = document.getElementById('search').value;
        document.getElementById('inputPanel').classList.toggle('hidden', q.length > 0);
        render();
    }

    function render() {
        const q = document.getElementById('search').value.toLowerCase();
        const container = document.getElementById('list');
        container.innerHTML = '';
        const filtered = db.filter(x => x.title.toLowerCase().includes(q));

        filtered.forEach(item => {
            const div = document.createElement('div');
            div.className = 'card';
            const img = item.img || 'https://via.placeholder.com/150/333/fff?text=NO+IMAGE';
            div.innerHTML = `
                <img src="${img}" class="card-img" onclick="zoom('${img}')">
                <div class="card-body">
                    <div class="card-title">${item.title}</div>
                    <button class="btn-copy-all" onclick='copyAll(${JSON.stringify(item.links)}, this)'>SALIN SEMUA LINK</button>
                    ${item.links.map(l => `
                        <a href="${l.u}" target="_blank" class="link-item">
                            <span>üîó ${l.u}</span>
                            <b class="comm-tag">${l.c}%</b>
                        </a>
                    `).join('')}
                    <div class="card-footer">
                        <span class="btn-act" onclick="edit(${item.id})">Edit</span>
                        <span class="btn-act" style="color:#ff4d2d" onclick="del(${item.id})">Hapus</span>
                    </div>
                </div>`;
            container.appendChild(div);
        });
    }

    function zoom(s) {
        document.getElementById('fullImg').src = s;
        document.getElementById('zoomBox').style.display = 'flex';
    }

    function edit(id) {
        const item = db.find(x => x.id == id);
        document.getElementById('editId').value = item.id;
        document.getElementById('pTitle').value = item.title;
        imgBase64 = item.img;
        document.getElementById('linksArea').innerHTML = '';
        item.links.forEach(l => addRow(l.u, l.c));
        window.scrollTo({top: 0, behavior: 'smooth'});
    }

    function del(id) {
        Swal.fire({ title: 'Hapus?', icon: 'warning', showCancelButton: true }).then(r => {
            if(r.isConfirmed) {
                db = db.filter(x => x.id !== id);
                localStorage.setItem('shopee_v6_final', JSON.stringify(db));
                render();
            }
        });
    }

    render();
</script>
</body>
</html>
